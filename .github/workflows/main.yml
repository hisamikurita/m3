name: GitHub Actions

on:
  push:
    branches: [master, main]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      #å…¬å¼ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€Œactions/checkoutã€å®Ÿè¡Œã™ã‚‹ã€‚ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¦ãã‚‹
      - name: ğŸ“¦ Get latest code
        uses: actions/checkout@v3

      #nodeã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®š
      - name: ğŸ’» Setup node
        uses: actions/setup-node@v3 #å…¬å¼ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹
        with: #å¼•æ•°ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³æŒ‡å®š
          node-version: "18"

      #ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
      - name: âš¡ Cache node modules
        uses: actions/cache@v3
        with:
          path: node_modules
          key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-node-

      #node moduleã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      - name: ğŸ˜‰ Install modules
        run: npm install && npm rebuild --arch=x64 --platform=linux sharp
        working-directory: ./ #ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒˆãƒƒãƒ—ã§å®Ÿè¡Œ

      #ãƒ“ãƒ«ãƒ‰
      - name: ğŸ¶ Build Project
        run: npm run build
        working-directory: ./ #ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒˆãƒƒãƒ—ã§å®Ÿè¡Œ

      #ãƒ“ãƒ«ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’FTPã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
      - name: ğŸ  Upload to FTP
        uses: SamKirkland/FTP-Deploy-Action@4.2.0
        with:
          server: ${{ secrets.FTP_SERVER }} #ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å…ˆã®ã‚µãƒ¼ãƒãƒ¼å
          username: ${{ secrets.FTP_ACCOUNT }} #ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å…ˆã®ã‚µãƒ¼ãƒãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå
          password: ${{ secrets.FTP_PASSWORD }} #ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å…ˆã®ã‚µãƒ¼ãƒãƒ¼ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
          local-dir: dist/ #ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸã„ãƒ•ã‚¡ã‚¤ãƒ«ã®éšå±¤ã‚’æŒ‡å®š
          server-dir: /m3/wp-content/themes/m3/ #ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å…ˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®š